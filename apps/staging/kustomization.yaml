apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: chama-staging

resources:
  - ../base

images:
  - name: gitauwairimu/chama-backend
    newName: gitauwairimu/main-backend
    newTag: 1.2.7-4d9dd47
  - name: gitauwairimu/chama-frontend
    newName: gitauwairimu/main-frontend
    newTag: 1.2.7-4d9dd47

patches:
  - path: backend-patch.yaml
    target:
      kind: Deployment
      name: backend
  - path: frontend-patch.yaml
    target:
      kind: Deployment
      name: frontend
  - path: hpa-patch.yaml
    target:
      kind: HorizontalPodAutoscaler
      name: backend-hpa







# apiVersion: kustomize.config.k8s.io/v1beta1
# kind: Kustomization

# namespace: chama-staging

# resources:
#   - ../base

# images:
#   - name: gitauwairimu/chama-backend
#     newName: gitauwairimu/main-backend
#     newTag: 1.2.7-4d9dd47
#   - name: gitauwairimu/chama-frontend
#     newName: gitauwairimu/main-frontend
#     newTag: 1.2.7-4d9dd47

# # Use the new patches format instead of deprecated patchesStrategicMerge
# patches:
#   - path: backend-patch.yaml
#     target:
#       kind: Rollout
#       name: backend
#   - path: frontend-patch.yaml
#     target:
#       kind: Deployment
#       name: frontend